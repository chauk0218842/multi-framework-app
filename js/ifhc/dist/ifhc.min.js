base64Encoder=typeof base64Encoder==="undefined"?window.btoa:base64Encoder;var ifhc=function(e){"use strict";if(typeof e.btoa==="undefined"){console.error("cannot instantiate ifhc: base64 encoder not available");return}var t=null;if(typeof ifhc!=="undefined"){t=ifhc}else if(typeof e.ifhc!=="undefined"){t=e.ifhc}t=t||{};t.version="1.0.1";ifhc=e.ifhc=t;var n=e.btoa;function r(e){"use strict";function t(){var e={};function t(t){return e[t]}function n(t,n){if(!(typeof t==="string"||typeof t==="number")){throw new Error(0,"invalid key type")}e[t]=n;return e[t]}function r(t){e[t]=null}return{get:t,set:n,remove:r}}function n(t){return e(t)}return{create:t,createKey:n}}function i(e){"use strict";function t(t){parent.postMessage(t,e.DOMAIN_NAME)}function n(e){return e.data}return{send:t,listen:n}}var c={GENERIC_TYPE:"generic type",CLIENT_LIST_TYPE:"client list type",TEXT_MESSAGE_TYPE:"text message type",FILES_TYPE:"files type"};function s(e){"use strict";function t(e){var t=i(e);t.list=e.list;return t}function n(e){var t=i(e);t.body=e.body;return t}function r(e){var t=i(e);t.files=e.files;return t}function i(t){return{type:t.type||e.GENERIC_TYPE,sender:t.sender,recipient:t.recipient,receipt:t.receipt}}function c(c){var s={};s[e.CLIENT_LIST_TYPE]=t;s[e.TEXT_MESSAGE_TYPE]=n;s[e.FILES_TYPE]=r;return s[c.type]?s[c.type](c):i(null)}return{"const":e,create:c}}var a={SERVER_NAME:"Window",DOMAIN_NAME:"*"};function o(e,t){"use strict";var n=[];var r=t.create();function i(e){n.push(e);r.set(e,n[n.length-1])}function c(e){r.remove(e)}function s(){return n.sort()}function a(t,n){document.getElementById(t).contentWindow.postMessage(n,e.DOMAIN_NAME)}return{"const":e,addClient:i,removeClient:c,getClientList:s,send:a}}function u(e){"use strict";var t="A";var n=0;function r(e,t,n,r){return{id:e,uri:t,client:n,"package":r}}function i(e,t){return r(e.id,e.uri,e.client,t)}function c(i,c,s){return r(String(e(t+n++)),i,c,s)}return{create:c,createResponse:i}}function f(){"use strict";function e(e){if(e>=1e9){e=(e/1e9).toFixed(2)+" GB"}else if(e>=1e6){e=(e/1e6).toFixed(2)+" MB"}else if(e>=1e3){e=(e/1e3).toFixed(2)+" KB"}else if(e>1){e=e+" bytes"}else if(e==1){e=e+" byte"}else{e="0 byte"}return e}function t(t){var n="";for(var r=0,i;i=t[r];r++){n+=r+1+". "+i.name+" ("+e(i.size)+")\n"}return n}return{formatBytesToUnits:e,createFileList:t}}function E(e,t,n,r,i,c){"use strict";var s=location.toString().replace(/^[^\?]+\?/g,"");var a=s.split("&");var o=a[0].replace(/^id=/g,"");var u=e.create();var f=[];var E=[];function l(e){var n=t.listen(e);var r=u.get(n.id);E.push(n);if(r){r.resolve(n)}console.log("%CLIENT% > Received a response from host: %RESPONSE%".replace(/%CLIENT%/g,o).replace(/%RESPONSE%/g,e.data.toString()));return c.when(i.process(n.package))}function p(e){var n=u.set(e.id,c.create());f.push(e);t.send(e);console.log('%CLIENT% > Sent a request to host: "%URI%"'.replace(/%CLIENT%/g,o).replace(/%URI%/g,e.uri));return n}function T(){return p(n.create(r.CONNECT_CLIENT,o,null)).then(function(e){return e.package})}function d(){return p(n.create(r.DISCONNECT_CLIENT,o,null)).then(function(e){return e.package})}function v(){return p(n.create(r.REQUEST_CLIENT_LIST,o,null)).then(function(e){return e.package})}function g(e,t,c){var s=[];for(var a=0,u=e.length;a<u;a++){var f=i.create({type:i.const.TEXT_MESSAGE_TYPE,sender:o,recipient:e[a],body:t,receipt:c});s.push(p(n.create(r.SEND_CLIENT_PACKAGE,o,f)))}return s}function S(e,t,c){var s=[];for(var a=0,u=e.length;a<u;a++){var f=i.create({type:i.const.FILES_TYPE,sender:o,recipient:e[a],files:t,receipt:c});s.push(p(n.create(r.SEND_CLIENT_PACKAGE,o,f)))}return s}function _(){return o}function C(){return f}function N(){return E}return{listen:l,connect:T,disconnect:d,getUsername:_,getClients:v,getRequestLog:C,getResponseLog:N,sendFiles:S,sendMessage:g}}function l(e){"use strict";function t(t){e.process(t.data);console.log("HOST > Processing a request: %URI%".replace(/%URI%/g,t.data.uri))}return{listen:t}}function p(e,t,n,r){"use strict";function i(e){e.list=["ALL"].concat(e.list);return r.when(e)}function c(e){e.body="%CLIENT% > %MESSAGE%<hr/>".replace(/%CLIENT%/g,e.sender).replace(/%MESSAGE%/g,e.body);return r.when(e)}function s(i){var c="";var s=[];var a=e.create();var o=i.files;var u=0;function f(e){var t=e.file;var r=e.url;u++;if(t.type.indexOf("image/")===0){c+="<br/>"+u+'. <a href = "'+r+'" target = "new">'+t.name+"</a> ("+n(t.size)+')<br/><a href = "'+r+'" target = "new"><img class = "thumbnail" src = '+r+"></a><br/>"}else if(t.type.indexOf("text/")===0){c+="<br/>"+u+'. <a href = "'+r+'" target = "new">'+t.name+"</a> ("+n(t.size)+")<br/>"}else if(t.type==="application/json"){debugger;c+="<br/>"+u+'. <a href = "'+r+'" target = "new">'+t.name+"</a> ("+n(t.size)+")<br/>"}}for(var E=0,l=o.length;E<l;E++){var p=new FileReader;var T=a.set(E,r.create());s.push(T);T.then(f);p.onloadend=function(e,t){return function(n){if(n.target.readyState==FileReader.DONE){a.get(e).resolve({file:t,url:n.target.result})}}}(E,o[E]);p.readAsDataURL(o[E])}return r.all(s).then(function(){return t.create({type:t.const.TEXT_MESSAGE_TYPE,sender:i.sender,recipient:i.recipient,body:"%CLIENT% > Received files...<br />".replace(/%CLIENT%/g,i.recipient)+c+"<hr/>",useReceipt:i.receipt})})}function a(e){var n={};n[t.const.CLIENT_LIST_TYPE]=i;n[t.const.TEXT_MESSAGE_TYPE]=c;n[t.const.FILES_TYPE]=s;return r.when(n[e.type](e))}var o=t;o.process=a;return o}var T={CONNECT_CLIENT:"HOST: connect client",DISCONNECT_CLIENT:"HOST: disconnect client",REQUEST_CLIENT_LIST:"HOST: request client list",SEND_CLIENT_PACKAGE:"HOST: send client package"};function d(e,t,n,r,i){"use strict";function c(r){var i=n.create({type:n.const.TEXT_MESSAGE_TYPE,sender:t.const.SERVER_NAME,recipient:r.client,body:"Connected to host",useReceipt:false});t.addClient(r.client);t.send(r.client,e.createResponse(r,i))}function s(r){var i=n.create({type:n.const.TEXT_MESSAGE_TYPE,sender:t.const.SERVER_NAME,recipient:r.client,body:"Disconnected from host",useReceipt:false});t.removeClient(r.client);t.send(r.client,e.createResponse(r,i))}function a(e){var n=t.getClientList();var r=[];for(var i=0,c=n.length;i<c;i++){if(n[i]===e){continue}r.push(n[i])}return r}function o(){var i=t.getClientList();for(var c=0,s=i.length;c<s;c++){var o=i[c];var u=n.create({type:n.const.CLIENT_LIST_TYPE,list:a(o)});t.send(o,e.create(r.REQUEST_CLIENT_LIST,o,u))}}function u(r){var i=n.create({type:n.const.CLIENT_LIST_TYPE,list:a(r.client)});t.send(r.client,e.createResponse(r,i))}function f(n){t.send(n.package.recipient,e.createResponse(n,n.package))}function E(r){var i=n.create({type:n.const.TEXT_MESSAGE_TYPE,sender:t.const.SERVER_NAME,recipient:r.client,body:"you 404'ed!!",useReceipt:false});t.send(r.client,e.createResponse(r,i))}function l(e){if(e.uri===r.CONNECT_CLIENT){c(e);o()}else if(e.uri===r.DISCONNECT_CLIENT){s(e);o()}else if(e.uri===r.REQUEST_CLIENT_LIST){u(e)}else if(e.uri===r.SEND_CLIENT_PACKAGE){f(e)}else if(i){}else{E(e)}}return{"const":r,process:l}}var v=f();var g={};g.client=i(a);g.hash=r(n);g.packageConst=c;g.package=s(g.packageConst);g.serverConst=a;g.server=o(g.serverConst,g.hash);g.transmission=u(g.hash.createKey);t.const={};t.const.route=T;t.const.package=g.package.const;t.host=function S(e){var n=d(g.transmission,g.server,g.package,t.const.route,e);return l(n)};t.client=function _(e){if(typeof e==="undefined"){console.error('cannot instantiate "client" - Deferred library not provided');return}var n=p(g.hash,g.package,v.formatBytesToUnits,e);return E(g.hash,g.client,g.transmission,t.const.route,n,e)};t.util=v;return t}(window);