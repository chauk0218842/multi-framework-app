<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>IFrame JQuery 2.1.1 Client</title>
    <link rel="stylesheet" href="CSS/Styles.css">
</head>
<body>

<script src="bower_components/jquery/dist/jquery.js"></script>
<script src="JS/fnDeferCreate_JQuery.js"></script>
<script src="JS/DeferHASH.js"></script>
<script src="JS/PMConstants.js"></script>
<script src="JS/PMError.js"></script>
<script src="JS/PMData.js"></script>
<script src="JS/PMClient.js"></script>
<script src="JS/PMCLibrary.js"></script>
<script>

    $("document").ready(function () {

        var _fnCreateDefer = fnDeferCreate_JQuery ($);
        var _DeferHASH  = DeferHASH (_fnCreateDefer);
        var _PMClient = PMClient (PMConstants, PMError, PMData);
        var _PMCLib = PMCLibrary (_PMClient, _DeferHASH);

        window.addEventListener("message", function (__oEvent) {

            /**
             * Listen for messages
             */
            _PMCLib.receive (__oEvent);

            /**
             * Update response
             */
            var ___oMessages = _PMCLib.getMessages ();
            var ___o$Response = $("#response");
            ___o$Response.val ((___oMessages.length ? ___oMessages [___oMessages.length - 1] + "\n--\n" : "") + ___o$Response.val ());

        });

        window.addEventListener("unload", function () {
            window.removeEventListener ("message");
        });

        _PMCLib.connect ();

        $("#clientName").text(_PMCLib.getClientName());

        $("#response").val ();

        _PMCLib.getContacts().then(function (_oContacts) {

            $("#contacts").empty();
            for (var n in _oContacts) {
                $("#contacts").append("<option value = \"" + _oContacts [n] + "\">" + _oContacts [n] + "</option>");
            }

            $("#contacts").index (0);
        });

        $("#refresh").bind("click", function () {

            _PMCLib.getContacts().then(function (_oContacts) {

                $("#contacts").empty();
                for (var n in _oContacts) {
                    $("#contacts").append("<option value = \"" + _oContacts [n] + "\">" + _oContacts [n] + "</option>");
                }
            });

        });

        $("#send").bind("click", function () {
            _PMCLib.send ($("#contacts").val (), $("#message").val());
        });

    });

</script>

<h3><span id="clientName"></span> (Powered by JQuery 2.1.1)</h3>

<textarea id="response" class = "response"></textarea>

<p>
    Contacts <select id="contacts"></select>
    <button id="refresh">Refresh</button>
</p>
<p>
    Message
    <br/><textarea id = "message" class = "message">Your message here...</textarea>
    <button id="send">Send</button>
</p>


</body>
</html>