var ifhc=function(e){"use strict";function n(e){function n(e){var n=i(e);return n.list=e.list,n}function t(e){var n=i(e);return n.body=e.body,n}function r(e){var n=i(e);return n.files=e.files,n}function i(n){return{type:n.type||e.GENERIC_TYPE,sender:n.sender,recipient:n.recipient,receipt:n.receipt}}function c(e){return o[e.type]?o[e.type](e):i(null)}var o={};return o[e.CLIENT_LIST_TYPE]=n,o[e.TEXT_MESSAGE_TYPE]=t,o[e.FILES_TYPE]=r,{"const":e,create:c}}function t(e){function n(n){parent.postMessage(n,e.DOMAIN_NAME)}function t(e){return e.data}return{send:n,listen:t}}function r(e){function n(){function e(e){return r[e]}function n(e,n){if("string"!=typeof e&&"number"!=typeof e)throw new Error(0,"invalid key type");return r[e]=n,r[e]}function t(e){r[e]=null}var r={};return{get:e,set:n,remove:t}}function t(n){return e(n)}return{create:n,createKey:t}}function i(e,n){function t(e){o.push(e),s.set(e,o[o.length-1])}function r(e){s.remove(e)}function i(){return o.sort()}function c(n,t){document.getElementById(n).contentWindow.postMessage(t,e.DOMAIN_NAME)}var o=[],s=n.create();return{"const":e,connectClient:t,disconnectClient:r,getConnectedClients:i,send:c}}function c(e){function n(e,n,t,r){return{id:e,uri:n,client:t,attachment:r}}function t(e,t){return n(e.id,e.uri,e.client,t)}function r(t,r,o){return n(String(e(i+c++)),t,r,o)}var i="A",c=0;return{create:r,createResponse:t}}function o(){function e(e){return e>=1e9?e=(e/1e9).toFixed(2)+" GB":e>=1e6?e=(e/1e6).toFixed(2)+" MB":e>=1e3?e=(e/1e3).toFixed(2)+" KB":e>1?e+=" bytes":1==e?e+=" byte":e="0 byte",e}function n(n){for(var t,r="",i=0;t=n[i];i++)r+=i+1+". "+t.name+" ("+e(t.size)+")\n";return r}return{formatBytesToUnits:e,createFileList:n}}function s(e,n,t,r){function i(e){return e.list=["ALL"].concat(e.list),r.when(e)}function c(e){return e.body="%CLIENT% > %MESSAGE%<hr/>".replace(/%CLIENT%/g,e.sender).replace(/%MESSAGE%/g,e.body),r.when(e)}function o(t){for(var i="",c=[],o=e.create(),s=t.files,u=0,E=0,l=s.length;l>E;E++){var f=new FileReader,T=o.set(E,r.create());c.push(T),T.then(function(e){u++,i+=a[e.file.type.replace(/(^application\/)+|(\/.*)/,"")](u,e.file)}),f.onloadend=function(e,n){return function(t){t.target.readyState==FileReader.DONE&&o.get(e).resolve({file:n,url:t.target.result})}}(E,s[E]),f.readAsDataURL(s[E])}return r.all(c).then(function(){return n.create({type:n.const.TEXT_MESSAGE_TYPE,sender:t.sender,recipient:t.recipient,body:"%CLIENT% > Sent files...<br />".replace(/%CLIENT%/g,t.sender)+i+"<hr/>",useReceipt:t.receipt})})}function s(e){return r.when(u[e.type](e))}var u={},a={};a.image=function(e,n){return"<br/>"+e+'. <a href = "'+n.url+'" target = "new">'+n.name+"</a> ("+t(n.size)+')<br/><a href = "'+n.url+'" target = "new"><img class = "thumbnail" src = '+n.url+"></a><br/>"},a.text=function(e,n){return"<br/>"+e+'. <a href = "'+n.url+'" target = "new">'+n.name+"</a> ("+t(n.size)+")<br/>"},a.json=function(e,n){return"<br/>"+e+'. <a href = "'+n.url+'" target = "new">'+n.name+"</a> ("+t(n.size)+")<br/>"},u[n.const.CLIENT_LIST_TYPE]=i,u[n.const.TEXT_MESSAGE_TYPE]=c,u[n.const.FILES_TYPE]=o;var E=n;return E.process=s,E}function u(e,n,t,r,i,c){function o(e){return e.sender=I,i.create(e)}function s(e){var t=n.listen(e),r=g.get(t.id);return v.push(t),r&&r.resolve(t),console.log("%CLIENT% > Received a response from host: %RESPONSE%".replace(/%CLIENT%/g,I).replace(/%RESPONSE%/g,e.data.toString())),c.when(i.process(t.attachment))}function u(e){var t=g.set(e.id,c.create());return L.push(e),n.send(e),console.log('%CLIENT% > Sent a request to host: "%URI%"'.replace(/%CLIENT%/g,I).replace(/%URI%/g,e.uri)),t}function a(e,n){return u(t.create(e,I,n)).then(function(e){return e.attachment})}function E(){return a(r.CONNECT_CLIENT,null)}function l(){return a(r.DISCONNECT_CLIENT,null)}function f(){return I}function T(){return a(r.REQUEST_CLIENT_LIST,null)}function p(){return L}function d(){return v}function S(e,n){for(var t=[],i=0,c=e.length;c>i;i++)n.recipient=e[i],t.push(a(r.SEND_CLIENT_ATTACHMENT,n));return t}function N(e,n,t){var r=o({type:i.const.TEXT_MESSAGE_TYPE,recipient:null,body:n,receipt:t});return S(e,r)}function _(e,n,t){var r=o({type:i.const.FILES_TYPE,recipient:null,files:n,receipt:t});return S(e,r)}var h=location.toString().replace(/^[^\?]+\?/g,""),C=h.split("&"),I=C[0].replace(/^id=/g,""),g=e.create(),L=[],v=[];return{listen:s,connect:E,disconnect:l,getUsername:f,getClients:T,getRequestLog:p,getResponseLog:d,sendMessage:N,sendFiles:_}}function a(e){function n(n){e.process(n.data),console.log("HOST > Processing a request: %URI%".replace(/%URI%/g,n.data.uri))}return{listen:n}}function E(e,n,t,r,i){function c(e){return e.sender=n.const.SERVER_NAME,t.create(e)}function o(r){var i=c({type:t.const.TEXT_MESSAGE_TYPE,recipient:r.client,body:"Connected to %SERVER%".replace(/%SERVER%/g,n.const.SERVER_NAME),receipt:!1});n.connectClient(r.client),n.send(r.client,e.createResponse(r,i))}function s(r){var i=c({type:t.const.TEXT_MESSAGE_TYPE,recipient:r.client,body:"Disconnected from %SERVER%".replace(/%SERVER%/g,n.const.SERVER_NAME),receipt:!1});n.disconnectClient(r.client),n.send(r.client,e.createResponse(r,i))}function u(e){for(var t=n.getConnectedClients(),r=[],i=0,c=t.length;c>i;i++)t[i]!==e&&r.push(t[i]);return r}function a(){for(var i=n.getConnectedClients(),o=0,s=i.length;s>o;o++){var a=i[o],E=c({type:t.const.CLIENT_LIST_TYPE,recipient:a,list:u(a),receipt:!1});n.send(a,e.create(r.REQUEST_CLIENT_LIST,a,E))}}function E(r){var i=c({type:t.const.CLIENT_LIST_TYPE,recipient:r.client,list:u(r.client),receipt:!1});n.send(r.client,e.createResponse(r,i))}function l(t){n.send(t.attachment.recipient,e.createResponse(t,t.attachment))}function f(r){var i=c({type:t.const.TEXT_MESSAGE_TYPE,recipient:r.client,body:"You 404'ed!!",receipt:!1});n.send(r.client,e.createResponse(r,i))}function T(e){return p[e.uri]?p[e.uri](e):p[r.INVALID_REQUEST](e)}var p={};return p[r.CONNECT_CLIENT]=function(e){o(e),a()},p[r.DISCONNECT_CLIENT]=function(e){s(e),a()},p[r.REQUEST_CLIENT_LIST]=function(e){E(e)},p[r.SEND_CLIENT_ATTACHMENT]=function(e){l(e)},p[r.INVALID_REQUEST]=f,{"const":r,process:T}}if("undefined"==typeof e.btoa)return void console.error("cannot instantiate ifhc: base64 encoder not available");var l=null;"undefined"!=typeof ifhc?l=ifhc:"undefined"!=typeof e.ifhc&&(l=e.ifhc),l=l||{},l.version="1.0.1",ifhc=e.ifhc=l;var f=e.btoa,T={GENERIC_TYPE:"generic type",CLIENT_LIST_TYPE:"client list type",TEXT_MESSAGE_TYPE:"text message type",FILES_TYPE:"files type"},p={SERVER_NAME:"Window",DOMAIN_NAME:"*"},d={INVALID_REQUEST:"invalid request",CONNECT_CLIENT:"connect client",DISCONNECT_CLIENT:"disconnect client",REQUEST_CLIENT_LIST:"request client list",SEND_CLIENT_ATTACHMENT:"send client attachment"},S=o(),N={};return N.client=t(p),N.hash=r(f),N.attachmentConst=T,N.attachment=n(N.attachmentConst),N.serverConst=p,N.server=i(N.serverConst,N.hash),N.transmission=c(N.hash.createKey),l.const={},l.const.route=d,l.const.attachment=N.attachment.const,l.host=function(e){var n=E(N.transmission,N.server,N.attachment,l.const.route,e);return a(n)},l.client=function(e){if("undefined"==typeof e)return void console.error('cannot instantiate "client" - Deferred library not provided');var n=s(N.hash,N.attachment,S.formatBytesToUnits,e);return u(N.hash,N.client,N.transmission,l.const.route,n,e)},l.util=S,l}(window);